<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Admin - Gestión de archivos</title>
  <link rel="stylesheet" href="/public/main.css" />
</head>
<body>
  <header>
    <h1>Panel Admin</h1>
    <p>Usuario: <%= user.email %> (<%= user.role %>) - <a href="/logout">Salir</a></p>
    <p><a href="/">Ver públicos</a></p>
  </header>

  <main>
    <section>
      <h2>Subir archivo</h2>
      <form action="/admin/upload" method="post" enctype="multipart/form-data">
        <div><input type="file" name="file" required></div>
        <div><label><input type="checkbox" name="public" checked> Público (visible para todos)</label></div>
        <div><button type="submit">Subir</button></div>
      </form>
    </section>

    <section>
      <h2>Archivos</h2>
      <% if (files.length === 0) { %>
        <p>No hay archivos.</p>
      <% } else { %>
        <table>
          <thead><tr><th>Nombre</th><th>Visible</th><th>Size</th><th>Uploader</th><th>Acciones</th></tr></thead>
          <tbody>
            <% files.forEach(function(f){ %>
              <tr>
                <form method="POST" action="/admin/file/<%= f.id %>/edit">
                  <td><input name="originalName" value="<%= f.originalName %>"></td>
                  <td><input type="checkbox" name="public" <%= f.public ? 'checked' : '' %>></td>
                  <td><%= Math.round(f.size/1024) %> KB</td>
                  <td><%= f.uploader %></td>
                  <td>
                    <button type="submit">Guardar</button>
                </form>
                <form method="POST" action="/admin/file/<%= f.id %>/delete" style="display:inline" onsubmit="return confirm('Borrar archivo?');">
                  <button type="submit">Borrar</button>
                </form>
                <a href="/files/download/<%= f.id %>">Descargar</a>
                </td>
              </tr>
            <% }) %>
          </tbody>
        </table>
      <% } %>
    </section>

    <section>
      <h2>Crear usuario (solo admin)</h2>
      <form method="POST" action="/admin/create-user">
        <div><label>Email: <input name="email" required></label></div>
        <div><label>Password: <input name="password" type="password" required></label></div>
        <div>
          <label>Role:
            <select name="role">
              <option value="uploader">uploader</option>
              <option value="admin">admin</option>
            </select>
          </label>
        </div>
        <div><button type="submit">Crear</button></div>
      </form>
    </section>
  </main>
</body>
</html>
